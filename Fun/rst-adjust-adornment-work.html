rst-adjust-adornment-work is a compiled Lisp function in `rst.el'.<br/><br/>(rst-adjust-adornment-work TOGGLE-STYLE REVERSE-DIRECTION)<br/><br/>Adjust/rotate the section adornment for the section title around point.<br/><br/>This function is meant to be invoked possibly multiple times, and<br/>can vary its behavior with a true TOGGLE-STYLE argument, or with<br/>a REVERSE-DIRECTION argument.<br/><br/>General Behavior<br/>================<br/><br/>The next action it takes depends on context around the point, and<br/>it is meant to be invoked possibly more than once to rotate among<br/>the various possibilities.  Basically, this function deals with:<br/><br/>- adding a adornment if the title does not have one;<br/><br/>- adjusting the length of the underline characters to fit a<br/>  modified title;<br/><br/>- rotating the adornment in the set of already existing<br/>  sectioning adornments used in the file;<br/><br/>- switching between simple and over-and-under styles.<br/><br/>You should normally not have to read all the following, just<br/>invoke the method and it will do the most obvious thing that you<br/>would expect.<br/><br/><br/>Adornment Definitions<br/>=====================<br/><br/>The adornments consist in<br/><br/>1. a CHARACTER<br/><br/>2. a STYLE which can be either of 'simple' or 'over-and-under'.<br/><br/>3. an INDENT (meaningful for the over-and-under style only)<br/>   which determines how many characters and over-and-under<br/>   style is hanging outside of the title at the beginning and<br/>   ending.<br/><br/>See source code for mode details.<br/><br/><br/>Detailed Behavior Description<br/>=============================<br/><br/>Here are the gory details of the algorithm (it seems quite<br/>complicated, but really, it does the most obvious thing in all<br/>the particular cases):<br/><br/>Before applying the adornment change, the cursor is placed on<br/>the closest line that could contain a section title.<br/><br/>Case 1: No Adornment<br/>--------------------<br/><br/>If the current line has no adornment around it,<br/><br/>- search backwards for the last previous adornment, and apply<br/>  the adornment one level lower to the current line.  If there<br/>  is no defined level below this previous adornment, we suggest<br/>  the most appropriate of the `rst-preferred-adornments'.<br/><br/>  If REVERSE-DIRECTION is true, we simply use the previous<br/>  adornment found directly.<br/><br/>- if there is no adornment found in the given direction, we use<br/>  the first of `rst-preferred-adornments'.<br/><br/>TOGGLE-STYLE forces a toggle of the prescribed adornment style.<br/><br/>Case 2: Incomplete Adornment<br/>----------------------------<br/><br/>If the current line does have an existing adornment, but the<br/>adornment is incomplete, that is, the underline/overline does<br/>not extend to exactly the end of the title line (it is either too<br/>short or too long), we simply extend the length of the<br/>underlines/overlines to fit exactly the section title.<br/><br/>If TOGGLE-STYLE we toggle the style of the adornment as well.<br/><br/>REVERSE-DIRECTION has no effect in this case.<br/><br/>Case 3: Complete Existing Adornment<br/>-----------------------------------<br/><br/>If the adornment is complete (i.e. the underline (overline)<br/>length is already adjusted to the end of the title line), we<br/>search/parse the file to establish the hierarchy of all the<br/>adornments (making sure not to include the adornment around<br/>point), and we rotate the current title's adornment from within<br/>that list (by default, going *down* the hierarchy that is present<br/>in the file, i.e. to a lower section level).  This is meant to be<br/>used potentially multiple times, until the desired adornment is<br/>found around the title.<br/><br/>If we hit the boundary of the hierarchy, exactly one choice from<br/>the list of preferred adornments is suggested/chosen, the first<br/>of those adornment that has not been seen in the file yet (and<br/>not including the adornment around point), and the next<br/>invocation rolls over to the other end of the hierarchy (i.e. it<br/>cycles).  This allows you to avoid having to set which character<br/>to use.<br/><br/>If REVERSE-DIRECTION is true, the effect is to change the<br/>direction of rotation in the hierarchy of adornments, thus<br/>instead going *up* the hierarchy.<br/><br/>However, if TOGGLE-STYLE, we do not rotate the adornment, but<br/>instead simply toggle the style of the current adornment (this<br/>should be the most common way to toggle the style of an existing<br/>complete adornment).<br/><br/><br/>Point Location<br/>==============<br/><br/>The invocation of this function can be carried out anywhere<br/>within the section title line, on an existing underline or<br/>overline, as well as on an empty line following a section title.<br/>This is meant to be as convenient as possible.<br/><br/><br/>Indented Sections<br/>=================<br/><br/>Indented section titles such as ::<br/><br/>   My Title<br/>   --------<br/><br/>are invalid in reStructuredText and thus not recognized by the<br/>parser.  This code will thus not work in a way that would support<br/>indented sections (it would be ambiguous anyway).<br/><br/><br/>Joint Sections<br/>==============<br/><br/>Section titles that are right next to each other may not be<br/>treated well.  More work might be needed to support those, and<br/>special conditions on the completeness of existing adornments<br/>might be required to make it non-ambiguous.<br/><br/>For now we assume that the adornments are disjoint, that is,<br/>there is at least a single line between the titles/adornment<br/>lines.